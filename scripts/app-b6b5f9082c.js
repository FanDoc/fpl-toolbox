!function(){"use strict";angular.module("fpl-toolbox",["cfp.loadingBar","ui.router"])}(),function(){"use strict";function e(){return{templateUrl:"app/components/sortThDirective/sort-th.html",link:function(e,t,l){var a=t.children(),o=angular.element(a.children()[0]);a.data("js-table-th-order-id",l.colId),o.html(l.colName)}}}angular.module("fpl-toolbox").directive("sortTh",e)}(),function(){"use strict";function e(e,t,l){var a="https://jsonp.afeld.me/?url=",o=a+"http://m.fantasy.premierleague.com/drf/",s={teamStrengths:{che:3,mci:5,ars:4,mun:5,tot:4,liv:4,sou:3,swa:3,stk:2,cry:3,eve:4,whu:4,wba:2,lei:3,"new":1,sun:1,avl:1,bou:2,wat:2,nor:2},init:function(e){return s.fixtures&&s.table?void e():(l.start(),void t.get(o+"bootstrap").success(function(r){return s.players=r.elements,s.gameweek=r["next-event"],s.teams=r.teams,s.gameweek?(l.set(.4),void t.get(o+"fixtures").success(function(o){s.fixtures=o,l.set(.7);var r="http://live.premierleague.com/syndicationdata/competitionId=8/seasonId=2015/matchDayId="+s.gameweek+"/league-table.json";t.get(a+r).success(function(t){s.table=t.Data,l.complete(),e()})})):(alert("Could not load data. Either Premier League or our proxy is having difficulties. Try again later!"),l.complete(),!1)}))}};return s}angular.module("fpl-toolbox").service("plResource",e),e.$inject=["$log","$http","cfpLoadingBar"]}(),function(){"use strict";function e(){return{require:"ngModel",link:function(e,t,l,a){a.$parsers.push(function(e){return parseInt(e,10)}),a.$formatters.push(function(e){return""+e})}}}angular.module("fpl-toolbox").directive("convertToNumber",e)}(),function(){"use strict";function e(e){function t(){e.init(function(){n.players=e.players,n.gameweek=e.gameweek,n.teams=_.sortBy(e.teams,"team"),_.forEach(n.teams,function(e){e.selected=!0}),_.forEach(n.players,function(e){e.points_per_pound=e.total_points/e.now_cost*10,e.ppg_per_pound=e.points_per_game/e.now_cost*10,e.cost=e.now_cost/10,e.selected_by_percent=parseFloat(e.selected_by_percent),e.points_per_game=parseFloat(e.points_per_game)}),a()})}function l(e){var t=angular.element(e.currentTarget),l=t.data("js-table-th-order-id");n.orderReverse=n.orderPredicate!==l||!n.orderReverse,n.orderPredicate=l,t.parent().parent().children().children().children().removeClass("glyphicon glyphicon-sort-by-order-alt glyphicon-sort-by-order"),angular.element(t.children()[1]).addClass("glyphicon").addClass(n.orderReverse?"glyphicon-sort-by-order-alt":"glyphicon-sort-by-order")}function a(){n.playersToShow=n.players,_.forEach(n.playerFilters.applyOrder,function(e){"function"==typeof n.playerFilters[e]&&(n.playersToShow=_.filter(n.playersToShow,n.playerFilters[e],n.playerFilters))})}function o(){n.playerFilters.healthy=!0,n.playerFilters.maxCost=15,n.playerFilters.minutes=0,s(),a()}function s(){_.forEach(n.teams,function(e){e.selected=!0})}function r(){_.forEach(n.teams,function(e){e.selected=!1})}var n=this;n.players=[],n.gameweek=0,n.teams=[],n.playersToShow=[],n.showFilters=!0,n.orderPredicate="ppg_per_pound",n.orderReverse=!0,n.playerFilters={healthy:!0,position:1,maxCost:15,minutes:0,applyOrder:["positionOnly","healthyOnly","minutesOnly","priceOnly","teamOnly"],healthyOnly:function(e){return!this.healthy||"a"===e.status},minutesOnly:function(e){return e.minutes>=this.minutes},positionOnly:function(e){return 0===this.position||e.element_type===this.position},teamOnly:function(e){return!n.teams||n.teams[e.team-1].selected},priceOnly:function(e){return e.cost<=this.maxCost}},n.orderPlayers=l,n.filter=a,n.resetFilters=o,n.selectAll=s,n.selectNone=r,t()}angular.module("fpl-toolbox").controller("PlayersController",e),e.$inject=["plResource"]}(),function(){"use strict";function e(e){function t(){e.init(function(){r.players=e.players,r.teams=e.teams,_.forEach(r.teams,function(t){t.strength=e.teamStrengths[t.short_name.toLowerCase()];var l=_.findWhere(e.table,{TeamCode:t.short_name.toUpperCase()});t.points=l.Points,t.goalsFor=l.GoalFor,t.goalsAgainst=-1*l.GoalAgainst}),r.gameweek=e.gameweek,r.fixtures=e.fixtures,s()})}function l(e){var t="";return _.each(e.fixtures,function(e){t+=e.code+e.homeaway+" "}),t}function a(e){var t=0;return _.each(e.fixtures,function(e){t+=r.teams[e.id-1][r.matchDifficultyDecider],e.home||(t+=r.teams[e.id-1][r.matchDifficultyDecider]*r.addAwayGameDifficulty/100)}),t}function o(){_.each(r.teams,function(e){e.fixturesDifficulty=a(e)})}function s(){_.forEach(r.teams,function(e){e.fixtures=[]});var e=_.filter(r.fixtures,function(e){return e.event>=r.gameweek&&e.event<r.gameweek+r.amountOfFixtures});_.forEach(e,function(e){r.teams[e.team_h-1].fixtures.push({id:e.team_a,code:r.teams[e.team_a-1].short_name,name:r.teams[e.team_a-1].name,homeaway:"(H)",home:!0}),r.teams[e.team_a-1].fixtures.push({id:e.team_h,code:r.teams[e.team_h-1].short_name,name:r.teams[e.team_h-1].name,homeaway:"(A)",home:!1})}),o()}var r=this;r.players=[],r.gameweek=0,r.teams=[],r.fixtures=[],r.addAwayGameDifficulty=25,r.amountOfFixtures=6,r.matchDifficultyDecider="points",r.getFixturesText=l,r.updateFixturesDifficulty=o,r.addFixturesToTeams=s,t()}angular.module("fpl-toolbox").controller("FixturesController",e),e.$inject=["plResource"]}(),function(){"use strict";function e(e,t){e.state("fixtures",{url:"/",templateUrl:"app/fixtures/fixtures.html",controller:"FixturesController",controllerAs:"fix"}).state("players",{url:"/players",templateUrl:"app/players/players.html",controller:"PlayersController",controllerAs:"pla"}).state("team",{url:"/team",templateUrl:"app/players/team-builder.html",controller:"PlayersController",controllerAs:"pla"}),t.otherwise("/")}angular.module("fpl-toolbox").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";angular.module("fpl-toolbox").constant("_",window._)}(),angular.module("fpl-toolbox").run(["$templateCache",function(e){e.put("app/fixtures/fixtures.html",'<div class="panel panel-default"><div class="panel-heading"><form class="form-horizontal"><div class="form-group"><label class="col-sm-2 control-label">Fixtures amount</label><div class="col-sm-10"><input class="form-control" max="10" min="1" ng-change="fix.addFixturesToTeams()" ng-model="fix.amountOfFixtures" type="number"></div></div><div class="form-group"><label class="col-sm-2 control-label">Start with week</label><div class="col-sm-10"><input class="form-control" max="38" min="1" ng-change="fix.addFixturesToTeams()" ng-model="fix.gameweek" type="number"></div></div><div class="form-group"><label class="col-sm-2 control-label">Away games are more difficult by</label><div class="col-sm-10"><div class="input-group"><input class="form-control" max="100" min="0" ng-model="fix.addAwayGameDifficulty" ng-change="fix.updateFixturesDifficulty()" type="number"><div class="input-group-addon">%</div></div></div></div><div class="form-group"><label class="col-sm-2 control-label">Decide fixtures difficulty by</label><div class="col-sm-10"><select class="form-control" ng-change="fix.updateFixturesDifficulty()" ng-model="fix.matchDifficultyDecider"><option value="points">Opponents league points</option><option value="strength">Opponents arbitrary strength variable</option><option value="goalsFor">Goals opponents scored this season (defensive difficulty)</option><option value="goalsAgainst">Goals opponents conceded this season (offensive difficulty)</option></select></div></div></form></div><table class="table table-hover"><tr><th></th><th>Team</th><th>Points</th><th>Goals for</th><th>Goals against</th><th>Strength</th><th>Fixtures</th><th>Fixtures difficulty</th></tr><tr ng-repeat="team in fix.teams | orderBy: \'fixturesDifficulty\'"><td><span class="clublogo logo{{team.id}}"></span></td><td>{{ team.name }}</td><td>{{ team.points }}</td><td>{{ team.goalsFor }}</td><td>{{ team.goalsAgainst }}</td><td><input class="form-control" max="10" min="0" ng-model="team.strength" ng-blur="fix.updateFixturesDifficulty()" style="width: auto" type="number"></td><td>{{ fix.getFixturesText(team) }}</td><td>{{ team.fixturesDifficulty | number:2 }}</td></tr></table></div>'),e.put("app/players/players.html",'<div class="panel panel-default"><div class="panel-heading" ng-show="pla.showFilters"><form class="form-horizontal"><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><div class="checkbox"><label><input ng-change="pla.filter()" ng-model="pla.playerFilters.healthy" type="checkbox"> Show only available players (doubtful, unavailable or injured are out)</label></div></div></div><div class="form-group"><label class="col-sm-2 control-label">Position</label><div class="col-sm-10"><select class="form-control" convert-to-number="" ng-change="pla.filter()" ng-model="pla.playerFilters.position"><option value="1">Goalkeepers</option><option value="2">Defenders</option><option value="3">Midfielders</option><option value="4">Attackers</option><option value="0">All players</option></select></div></div><div class="form-group"><label class="col-sm-2 control-label">Minimum minutes</label><div class="col-sm-10"><input class="form-control" max="3420" min="0" ng-change="pla.filter()" ng-model="pla.playerFilters.minutes" type="number"></div></div><div class="form-group"><label class="col-sm-2 control-label">Maximum cost</label><div class="col-sm-10"><input class="form-control" max="15" min="4" ng-change="pla.filter()" ng-model="pla.playerFilters.maxCost" type="number"></div></div><div class="form-group"><label class="col-sm-2 control-label">Include teams</label><div class="col-sm-10"><ul class="list-inline list-unstyled"><li ng-repeat="team in pla.teams" class="col-sm-2"><input ng-change="pla.filter()" ng-model="team.selected" type="checkbox"> {{team.short_name}}</li></ul>select <a href="" ng-click="pla.selectAll()">all</a> / <a href="" ng-click="pla.selectNone()">none</a></div></div></form></div><div class="panel-body pull-right"><a href="" ng-click="pla.resetFilters()">reset filters</a> <span class="glyphicon glyphicon-refresh"></span> <span ng-show="pla.showFilters"><a href="" ng-click="pla.showFilters = false">hide</a> <span class="glyphicon glyphicon-menu-up"></span></span> <span ng-show="!pla.showFilters"><a href="" ng-click="pla.showFilters = true">show filters</a> <span class="glyphicon glyphicon-menu-down"></span></span></div><table class="table table-hover"><tr><th></th><th>Name</th><th>Status</th><th col-id="total_points" col-name="Total points" sort-th=""></th><th col-id="cost" col-name="Cost" sort-th=""></th><th col-id="points_per_game" col-name="Points per game" sort-th=""></th><th col-id="points_per_pound" col-name="Points per pound" sort-th=""></th><th col-id="ppg_per_pound" col-name="Points per game per pound" sort-th=""></th><th col-id="minutes" col-name="Minutes" sort-th=""></th><th col-id="selected_by_percent" col-name="Selected by %" sort-th=""></th></tr><tr ng-repeat="player in pla.playersToShow | orderBy:pla.orderPredicate:pla.orderReverse"><td><span class="clublogo logo{{player.team}}"></span></td><td>{{ player.first_name }} {{ player.second_name}}</td><td>{{ player.status }}</td><td>{{ player.total_points }}</td><td>{{ player.cost }}</td><td>{{ player.points_per_game }}</td><td>{{ player.points_per_pound | number:2 }}</td><td>{{ player.ppg_per_pound | number:2 }}</td><td>{{ player.minutes }}</td><td>{{ player.selected_by_percent }}</td></tr></table></div>'),e.put("app/players/team-builder.html","<h1>team builder todo</h1>"),e.put("app/components/sortThDirective/sort-th.html",'<th><div ng-click="pla.orderPlayers($event)" class="table-th-order" js-table-th-order-id=""><span class="js-table-th-order-name"></span> <span></span></div></th>')}]);